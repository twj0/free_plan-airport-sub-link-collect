中文版点击：[chinese](README-zhcn.md) | English
# Free Airport Node Subscription Collector

This is a Python project designed to automatically log into various "airport" (proxy provider) websites, retrieve subscription links for their free nodes, and merge all nodes into a single Clash subscription file.

## ✨ Features

- **Multi-site Support**: Comes with built-in clients for several providers and can be easily extended.
- **Automated Login**: Simulates website logins and automatically handles tasks like daily check-ins or purchasing free plans.
- **Intelligent Parsing**: Capable of parsing multiple node formats, including Clash (YAML) and Base64-encoded links (SS, Vmess, Trojan).
- **Config Merging**: Automatically merges all retrieved nodes into a predefined Clash configuration template.
- **Flexible Configuration**: Supports two methods for credential management:
    1.  **Local Testing**: Use a `user_credentials.json` (the original is in Chinese) file for quick local debugging.
    2.  **CI/CD Integration**: Securely run in CI/CD environments like GitHub Actions using environment variables.
- **Detailed Logging**: Provides detailed logs of its operations for easy troubleshooting.
- **Error Snapshots**: For clients that use browser simulation (like ikuuu), it automatically saves a screenshot and the page source upon failure, aiding the debugging process.

## 📂 Project Structure

```
.
├── .github/workflows/      # GitHub Actions workflows
│   ├── daily_update.yml
│   └── weekly_update.yml
├── clients/                # Directory for all airport clients
│   ├── __init__.py
│   ├── dabai_client.py
│   ├── huaxia_client.py
│   ├── ikuuu_client.py
│   └── louwangzhiyu_client.py
├── .gitignore
├── base.yaml               # Base template for the Clash configuration
├── main.py                 # Main application script
├── merged_subscription.yaml  # The final generated subscription file
├── requirements.txt        # Python dependency list
├── user_credentials.json         # (Optional) Credentials file for local testing
├── README.md               # This file (English)
└── README-zhcn.md          # Chinese README
```

- **`main.py`**: The project's entry point and main logic, responsible for orchestrating clients, parsing content, and generating the final config.
- **`clients/`**: The core directory where each file is a client implementation for a specific airport.
- **`base.yaml`**: The Clash configuration template. The script injects all fetched nodes into the `proxies` section and automatically populates `proxy-groups` based on placeholders (`[AUTO]`, `[SITE:...]`).
- **`merged_subscription.yaml`**: The final Clash subscription file generated by the script.
- **`user_credentials.json`**: **For local testing only**. The script was modified to read credentials from this file for easier debugging. This file should not be committed to GitHub.

## 🚀 How to Use

### 1. Prerequisites

- Install [Python 3](https://www.python.org/)
- Ensure `pip` is available.

### 2. Install Dependencies

Open a terminal in the project root and run:
```bash
pip install -r requirements.txt
```
This will install `requests`, `pyyaml`, `beautifulsoup4`, `selenium`, and all other necessary libraries.

### 3. Configure Credentials

You have two ways to configure your login credentials:

**Method 1: Local Testing (Recommended)**

1.  In the project root, find or create the file `user_credentials.json`.
2.  Fill in your email and password for each site using the following format:

    ```json
    {
      "ikuuu": {
        "username1": "your_ikuuu_email@example.com",
        "password": "your_ikuuu_password"
      },
      "大白": {
        "username1": "your_dabai_email@example.com",
        "password": "your_dabai_password"
      },
      "华夏联盟": {
        "username1": "your_huaxia_email@example.com",
        "password": "your_huaxia_password"
      },
      "漏网之鱼": {
        "username1": "your_louwangzhiyu_email@example.com",
        "password": "your_louwangzhiyu_password"
      }
    }
    ```
    **Note**: The keys (like "大白") are in Chinese and must match the names used in the code.

**Method 2: Production / GitHub Actions**

In a production or CI/CD environment, you should use environment variables for security. The script will prioritize environment variables over the JSON file.

Set the variables in the following format:
- `DABAI_EMAIL` / `DABAI_PASSWORD`
- `IKUUU_EMAIL` / `IKUUU_PASSWORD`
- `WWN_EMAIL` / `WWN_PASSWORD`
- `LOUWANGZHIYU_EMAIL` / `LOUWANGZHIYU_PASSWORD`

### 4. Run the Script

After configuring credentials, run the following command from the project root:
```bash
python main.py weekly
```
The script will execute all tasks and save the result in `merged_subscription.yaml`.

## 🛠️ Client Status

Based on the latest tests, the status of each client is as follows:

| Client | Status | Remarks |
| :--- | :--- | :--- |
| **Dabai (大白)** | ✅ **Stable** | Fully functional and runs reliably. |
| **ikuuu** | ✅ **Stable** | After several fixes, the Selenium client can now reliably handle the complex frontend. |
| **Huaxia (华夏联盟)** | ❌ **Unfixable** | Login is successful, but the server returns an empty subscription link. This is a server-side issue. |
| **Louwangzhiyu (漏网之鱼)** | ❌ **Unfixable** | The site uses advanced anti-bot measures that cannot be bypassed with standard Selenium techniques. |

## 🤝 How to Contribute

If you want to add support for a new airport, you can follow these steps:

1.  Create a new `xxx_client.py` file in the `clients/` directory.
2.  Following the structure of `dabai_client.py` (for requests-based sites) or `ikuuu_client.py` (for selenium-based sites), implement the login and subscription link retrieval logic.
3.  Add an entry for your new client in the `TASKS` dictionary in `main.py`.
4.  (Optional) Document the credential format for your new client.
5.  Submit a Pull Request.

---